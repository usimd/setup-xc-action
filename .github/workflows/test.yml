name: Example Workflow

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test-xc8:
    runs-on: ubuntu-latest
    name: Test XC8 Installation
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm ci

      - name: Build action
        run: npm run build

      - name: Setup XC8 Compiler
        uses: ./
        with:
          compiler: 'xc8'
          version: '3.10'

      - name: Verify XC8 Installation
        run: |
          which xc8
          xc8 --version

  test-xc16:
    runs-on: ubuntu-latest
    name: Test XC16 Installation
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm ci

      - name: Build action
        run: npm run build

      - name: Setup XC16 Compiler
        uses: ./
        with:
          compiler: 'xc16'
          version: '2.10'

      - name: Verify XC16 Installation
        run: |
          which xc16-gcc
          xc16-gcc --version

  test-xc32:
    runs-on: ubuntu-latest
    name: Test XC32 Installation
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm ci

      - name: Build action
        run: npm run build

      - name: Setup XC32 Compiler
        uses: ./
        with:
          compiler: 'xc32'
          version: '5.00'

      - name: Verify XC32 Installation
        run: |
          which xc32-gcc
          xc32-gcc --version

  test-custom-dir:
    runs-on: ubuntu-latest
    name: Test Custom Installation Directory
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm ci

      - name: Build action
        run: npm run build

      - name: Setup XC8 with Custom Directory
        id: setup-xc8
        uses: ./
        with:
          compiler: 'xc8'
          version: '3.10'
          install-dir: '/usr/local/microchip'

      - name: Verify Custom Directory
        run: |
          echo "Install directory: ${{ steps.setup-xc8.outputs.install-dir }}"
          echo "Compiler path: ${{ steps.setup-xc8.outputs.compiler-path }}"
          test -d "${{ steps.setup-xc8.outputs.install-dir }}"
          test -d "${{ steps.setup-xc8.outputs.compiler-path }}"

  test-matrix:
    runs-on: ubuntu-latest
    name: Test Matrix Build
    strategy:
      matrix:
        compiler: ['xc8', 'xc16', 'xc32']
        include:
          - compiler: 'xc8'
            version: '3.10'
            binary: 'xc8'
          - compiler: 'xc16'
            version: '2.10'
            binary: 'xc16-gcc'
          - compiler: 'xc32'
            version: '5.00'
            binary: 'xc32-gcc'
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm ci

      - name: Build action
        run: npm run build

      - name: Setup ${{ matrix.compiler }}
        uses: ./
        with:
          compiler: ${{ matrix.compiler }}
          version: ${{ matrix.version }}

      - name: Verify Installation
        run: |
          which ${{ matrix.binary }}
          ${{ matrix.binary }} --version


